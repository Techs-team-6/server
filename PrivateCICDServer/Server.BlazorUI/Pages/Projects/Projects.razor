@page "/projects/"
@using Server.API.Client
@inject ProjectClient ProjectClient
@inject NavigationManager NavigationManager
<h3>Projects</h3>
<div class="container">
    @foreach (var project in ProjectClient.ListAsync().Result)
    {
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">@project.Name</h5>
                <h6 class="card-subtitle mb-2 text-muted">@project.Id</h6>
                <a href="/projects/@project.Name" class="card-link">Details</a>
            </div>
        </div>
    }
</div>
<div class="container">
    <button class="btn btn-primary" @onclick="@(_ => _createDialog.Show())">New</button>
</div>
<CreateDialog @ref="_createDialog" OnCreate="@OnCreate"/>

@code
{
    CreateDialog _createDialog = null!;

    [CascadingParameter(Name = "ErrorComponent")]
    protected IErrorComponent ErrorComponent { get; set; } = null!;

    private void OnCreate(string name)
    {
        try
        {
            var project = ProjectClient.CreateAsync(name, "build").Result;
            NavigationManager.NavigateTo($"projects/{project.Name}");
        }
        catch (Exception e)
        {
            ErrorComponent.ShowError("An error has occured", e.Message);
        }
    }
}